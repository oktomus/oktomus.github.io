<!doctype html>
<html lang="en-us">
  <head>
    <title>Simple steps to optimize a Unity project</title>
    <meta charset="utf-8" />
    <meta name="generator" content="Hugo 0.82.1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="Kevin Masson" />
    <meta name="description" content="Unity is very complex and optimizing something is a life-time task. These are the first things to consider for optimizing every Unity game or app. In the end, you will get a better framerate." />
    
    <link rel="stylesheet" href="https://oktomus.com/style.b716ed914e32cae2ba7e1e4188b61195ebb9f50d710756439e5891641edc6510.css" />

    
    <link rel="stylesheet" href="https://oktomus.com/sourcesanspro.976c714211e70394d35449e7ce2aee72b91cbf727b752cfb6a9c52bbc22c00fa.css" />

    
      
      <link rel="stylesheet" href="https://oktomus.com/sourcecodepro.5dad8ddf281225439c9ef9a8ed92baf168af538c41d755c1fe26cc869ed0e6f3.css" />
    

    <meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://oktomus.com/2021/optimize-a-unity-project.jpg"/>

<meta name="twitter:title" content="Simple steps to optimize a Unity project"/>
<meta name="twitter:description" content="Unity is very complex and optimizing something is a life-time task. These are the first things to consider for optimizing every Unity game or app. In the end, you will get a better framerate."/>

    <meta property="og:title" content="Simple steps to optimize a Unity project" />
<meta property="og:description" content="Unity is very complex and optimizing something is a life-time task. These are the first things to consider for optimizing every Unity game or app. In the end, you will get a better framerate." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://oktomus.com/posts/2021/optimize-a-unity-project/" /><meta property="og:image" content="https://oktomus.com/2021/optimize-a-unity-project.jpg" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-04-24T00:00:00&#43;00:00" />
<meta property="article:modified_time" content="2021-04-24T00:00:00&#43;00:00" />


  </head>
  <body>
    <header class="app-header">
      <a href="https://oktomus.com/"><img width="100" height="100" class="app-header-avatar" src="/avatar.jpg" alt="Kevin Masson" /></a>
      <h1 class="site-title">oktomus</h1>
      
      <p>
        Programming, mostly visual stuff.
        Based in France.
      </p>
      <div class="app-header-social">
        
          <a target="_blank" href="https://github.com/oktomus" rel="noreferrer noopener" title="Github"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github">
  <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
</svg></a>
        
          <a target="_blank" href="https://twitter.com/oktomus" rel="noreferrer noopener" title="Twitter"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-twitter">
  <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path>
</svg></a>
        
          <a target="_blank" href="mailto:contact@oktomus.com" rel="noreferrer noopener" title="contact@oktomus.com"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-mail">
  <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline>
</svg></a>
        
      </div>
    </header>
    <main class="app-container">
      
  <article class="post">
    <header class="post-header">
      <h1 class ="post-title">Simple steps to optimize a Unity project</h1>
      <div class="post-meta">
        24 Apr 2021
        &nbsp;<span class="separator">·</span>&nbsp;
        5 min read&nbsp;<span class="separator">·</span>&nbsp;
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github">
  <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
</svg>
        <a href="https://github.com/oktomus/website/blob/master/content/posts/2021/optimize-a-unity-project.md" rel="nofollow">1 contributor</a></div>
    </header>
    <div class="post-content">
      <p>I have spent hours using the Unity profiler to understand how to make things go faster. By doing so, I have learned a lot about Unity, how does it work and how to prevent a bad framerate or a FPS drop. In this post, I introduce 4 simple tips that you can implement to improve your framerate and learn more about Unity.</p>
<p>TL; DR:</p>
<ul>
<li>Use <code>sharedMesh</code> instead of <code>mesh</code> and <code>sharedMaterial</code> instead of <code>material</code>.</li>
<li>Disable mesh and texture CPU reading and free procedural mesh CPU memory with <code>mesh.UploadMeshData(true)</code></li>
<li>Before calling <code>Instantiate(something, container)</code>, hide the container with <code>container.gameObject.SetActive(false)</code></li>
<li>Cache <code>Camera.main</code> value</li>
</ul>
<h2 id="dont-duplicate-meshes-and-materials">Don&rsquo;t duplicate meshes and materials</h2>
<p>When you call the <code>mesh</code> property on a <code>MeshFilter</code> component, you should know that asset duplication may occur.</p>
<p>To access the mesh data, Unity provides 2 properties: <code>mesh</code> and <code>sharedMesh</code>.</p>
<p><code>mesh</code> will give you a unique mesh object. If you have a mesh that is used more than once and you call <code>.mesh</code> instead of <code>.sharedMesh</code>, Unity will duplicate the mesh to return a unique reference. This will impact both memory usage and rendering cost.</p>
<p>Unless you specifically want a unique reference, and potentially duplicate a mesh, you should use <code>sharedMesh</code> instead.</p>
<p>The same logic applies to <code>material</code> and <code>sharedMaterial</code> on the <code>MeshRenderer</code> component.</p>
<h2 id="use-less-mesh-and-texture-memory">Use less mesh and texture memory</h2>
<p>You can choose to enable or not Read/Write when importing a texture or a mesh. When enabled, the asset will use <strong>twice as much memory</strong>!</p>
<p><img src="/2021/optimize-a-unity-project-read-write.png" alt="Unity import settings"></p>
<p>At runtime, assets are stored on the GPU memory so that we can display them. But to edit them with C#, they also need to be on a memory space where the CPU can read and write.</p>
<p>Unless you plan to edit the assets content with C#, you should disable this option to use the less amount of runtime memory possible.</p>
<hr>
<p>This tip is also important for procedural assets generated at runtime. By default, when you generate a texture or a mesh, its memory stays duplicated. But once your asset is generated, you can free half of the memory (and lose the ability to edit it with C#):</p>
<div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#999;font-style:italic">//=&gt; Generating a mesh at runtime.
</span><span style="color:#999;font-style:italic"></span><span style="color:#6ab825;font-weight:bold">var</span> mesh = <span style="color:#6ab825;font-weight:bold">new</span> Mesh();
<span style="color:#999;font-style:italic">// ...
</span><span style="color:#999;font-style:italic">// Free half of the memory, now the asset is only on the GPU memory.
</span><span style="color:#999;font-style:italic"></span>mesh.UploadMeshData(makeNoLongerReadable: <span style="color:#6ab825;font-weight:bold">true</span>);

<span style="color:#999;font-style:italic">//=&gt; Generating a texture at runtime.
</span><span style="color:#999;font-style:italic"></span><span style="color:#6ab825;font-weight:bold">var</span> texture = <span style="color:#6ab825;font-weight:bold">new</span> Texture2D(<span style="color:#999;font-style:italic">/* ... */</span>);
<span style="color:#999;font-style:italic">// ...
</span><span style="color:#999;font-style:italic">// Free half of the memory.
</span><span style="color:#999;font-style:italic"></span>texture.Apply(makeNoLongerReadable: <span style="color:#6ab825;font-weight:bold">true</span>);
</code></pre></div><p>You can use the following code snippet to find which meshes have duplicated memory and optimize memory usage:</p>
<div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#999;font-style:italic">/// &lt;summary&gt;
</span><span style="color:#999;font-style:italic">/// For testing purpose only.
</span><span style="color:#999;font-style:italic">/// Reduce memory usage of all meshes by storing them only on the GPU,
</span><span style="color:#999;font-style:italic">/// and lose the ability to edit them with C#.
</span><span style="color:#999;font-style:italic">/// &lt;/summary&gt;
</span><span style="color:#999;font-style:italic"></span><span style="color:#bbb">[MenuItem(&#34;Tools/Disable isReadable on all meshes&#34;)]</span>
<span style="color:#6ab825;font-weight:bold">public</span> <span style="color:#6ab825;font-weight:bold">static</span> <span style="color:#6ab825;font-weight:bold">void</span> SendMeshesToGPU()
{
    <span style="color:#6ab825;font-weight:bold">int</span> removed = <span style="color:#3677a9">0</span>;
    <span style="color:#6ab825;font-weight:bold">int</span> alreadyOnGPU = <span style="color:#3677a9">0</span>;

    <span style="color:#6ab825;font-weight:bold">foreach</span> (<span style="color:#6ab825;font-weight:bold">var</span> filter <span style="color:#6ab825;font-weight:bold">in</span> FindObjectsOfType&lt;MeshFilter&gt;())
    {
        <span style="color:#6ab825;font-weight:bold">if</span> (filter.sharedMesh)
        {
            <span style="color:#6ab825;font-weight:bold">if</span> (filter.sharedMesh.isReadable)
            {
                filter.sharedMesh.UploadMeshData(<span style="color:#6ab825;font-weight:bold">true</span>);
                ++removed;
            }
            <span style="color:#6ab825;font-weight:bold">else</span>
            {
                ++alreadyOnGPU;
            }
        }
    }

    <span style="color:#999;font-style:italic">// Bad news.
</span><span style="color:#999;font-style:italic"></span>    <span style="color:#6ab825;font-weight:bold">if</span> (removed &gt; <span style="color:#3677a9">0</span>)
        Debug.LogWarning(
            <span style="color:#ed9d13">&#34;Removed &#34;</span> + removed + <span style="color:#ed9d13">&#34; meshes from the CPU memory.&#34;</span>);

    <span style="color:#999;font-style:italic">// Good news.
</span><span style="color:#999;font-style:italic"></span>    Debug.Log(
        alreadyOnGPU + <span style="color:#ed9d13">&#34; meshes were already on the GPU and not on the CPU.&#34;</span>);
}
</code></pre></div><h2 id="disable-before-instantiate">Disable before instantiate</h2>
<p>When instantiating stuff into an object, Unity will invalidate the object to make sure everything is set up properly on the next frame.</p>
<div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#999;font-style:italic">// Container will be invalidated.
</span><span style="color:#999;font-style:italic"></span>Instantiate(prototype, container);
</code></pre></div><p>This can slowdown your game very badly in some cases. For example, let&rsquo;s say you are filling a UI Scroll with some elements. Each element added
will invalidate the Scroll and in the end, you can notice a huge framrate spike.</p>
<p>To keep your framerate stable and make sure Unity doesn&rsquo;t run too much tasks for nothing, you can hide the container while filling it:</p>
<div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#999;font-style:italic">// Deactivate the container.
</span><span style="color:#999;font-style:italic"></span>target.gameObject.SetActive(<span style="color:#6ab825;font-weight:bold">false</span>);

Instantiate(source, target);

<span style="color:#999;font-style:italic">// Activate the container.
</span><span style="color:#999;font-style:italic"></span>target.gameObject.SetActive(<span style="color:#6ab825;font-weight:bold">true</span>);
</code></pre></div><p>You won&rsquo;t notice a visual difference if you deactivate, fill and activate during the same frame. But you will notice a performance difference
depending and how many object you instantiate and how your UI is built.</p>
<blockquote>
<p>This tip can also be used for non-UI stuff. Test it and profile it to see if it makes a difference.</p>
</blockquote>
<h2 id="cache-cameramain">Cache <code>Camera.main</code></h2>
<blockquote>
<p>Since Unity 2020, this property has been optimized and should not be a problem anymore.</p>
</blockquote>
<p>Under the hood, <code>FindGameObjectsWithTag</code> is used to find the main camera. If you use <code>Camera.main</code> at many places in your code, especially in <code>Update</code> or <code>LateUpdate</code>, your framerate is probably affected.</p>
<p>The simplest solution is to make sure you don&rsquo;t call <code>Camera.main</code> more than once per frame. To do so, create a simple component that store <code>Camera.main</code> and call <code>CameraManager.Main</code> instead of <code>Camera.main</code> everywhere in your code.</p>
<div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#6ab825;font-weight:bold">using</span> <span style="color:#447fcf;text-decoration:underline">UnityEngine</span>;

<span style="color:#999;font-style:italic">/// &lt;summary&gt;
</span><span style="color:#999;font-style:italic">/// Cache Camera.main Unity property to make sure we don&#39;t call it more than once per frame
</span><span style="color:#999;font-style:italic">/// and affect the framerate.
</span><span style="color:#999;font-style:italic">/// &lt;/summary&gt;
</span><span style="color:#999;font-style:italic"></span><span style="color:#6ab825;font-weight:bold">public</span> <span style="color:#6ab825;font-weight:bold">class</span> <span style="color:#447fcf;text-decoration:underline">CameraManager</span> : MonoBehaviour
{
    <span style="color:#6ab825;font-weight:bold">public</span> <span style="color:#6ab825;font-weight:bold">static</span> Camera Main { <span style="color:#6ab825;font-weight:bold">get</span>; <span style="color:#6ab825;font-weight:bold">private</span> <span style="color:#6ab825;font-weight:bold">set</span>; }

    <span style="color:#6ab825;font-weight:bold">void</span> Update()
    {
        Main = Camera.main;
    }
}
</code></pre></div><p>Make sure that this script is running before other scripts by changing the execution order in <code>Edit &gt; Project Settings &gt; Script Execution Order</code>. In this way, the <code>CameraManager.Main</code> property will never change in the middle of a frame for other scripts.</p>
<p><img src="/2021/optimize-a-unity-project-camera-manager.png" alt="Script execution order"></p>
<p>To make it even better, don&rsquo;t set <code>Main</code> property in <code>Update()</code>, but only when you know that the main camera is changing.</p>
<h2 id="use-the-profiler">Use the profiler</h2>
<p>I hope that these tips helped you in a way. But keep in mind that these tips I showed here are very basic and may not have the effect you whished for. To take the best out of Unity and your game, you should use the Profiler.</p>
<p>Tell me how you managed to improve your framerate !</p>

    </div>
    <!-- begin comments //-->
    <div class="post-footer">
      <section id="isso-thread"></section>
      <script data-isso="https://isso.oktomus.com/" src="https://isso.oktomus.com/js/embed.min.js" defer></script>
    </div>
    <!-- end comments //-->
  </article>

    </main>

    <script src="https://oktomus.com/js/matomo.6767f6a74e49660a57c7272610f9abc3edb7253ff71868c61eba591989962cef.js" defer></script>
  </body>
</html>

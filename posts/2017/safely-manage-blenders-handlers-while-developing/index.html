<!doctype html><html lang=en-us><head><title>Safely manage Blender's handlers while developing</title><meta charset=utf-8><meta name=generator content="Hugo 0.61.0"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Kevin Masson"><meta name=description content="Understand how Blender python handlers work while developing an addon."><link rel=stylesheet href=https://oktomus.com/style.825020f89ad794e229963f2e6bc0a98e7146e0b89291dd7e0b29ed5e461077b8.css><link rel=stylesheet href=https://oktomus.com/sourcesanspro.976c714211e70394d35449e7ce2aee72b91cbf727b752cfb6a9c52bbc22c00fa.css><link rel=stylesheet href=https://oktomus.com/sourcecodepro.5dad8ddf281225439c9ef9a8ed92baf168af538c41d755c1fe26cc869ed0e6f3.css><meta name=twitter:card content="summary"><meta name=twitter:title content="Safely manage Blender's handlers while developing"><meta name=twitter:description content="Understand how Blender python handlers work while developing an addon."><meta property="og:title" content="Safely manage Blender's handlers while developing"><meta property="og:description" content="Understand how Blender python handlers work while developing an addon."><meta property="og:type" content="article"><meta property="og:url" content="https://oktomus.com/posts/2017/safely-manage-blenders-handlers-while-developing/"><meta property="article:published_time" content="2017-07-14T21:06:12+01:00"><meta property="article:modified_time" content="2017-07-14T21:06:12+01:00"></head><body><header class=app-header><a href=https://oktomus.com/><img width=100 height=100 class=app-header-avatar src=/avatar.jpg alt="Kevin Masson"></a><h1><a href=https://oktomus.com/>oktomus</a></h1><p>Makes 3D softwares and photography while eating noodles.</p><div class=app-header-social><a target=_blank href=https://github.com/oktomus rel="noreferrer noopener" title=Github><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77a5.44 5.44.0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a><a target=_blank href=https://twitter.com/oktomus rel="noreferrer noopener" title=Twitter><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-twitter"><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a><a target=_blank href=mailto:hi@oktomus.com rel="noreferrer noopener" title=hi@oktomus.com><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-mail"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></a><a target=_blank href=https://www.linkedin.com/in/oktomus/ rel="noreferrer noopener" title=LinkedIn><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-linkedin"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></a><a target=_blank href=https://www.instagram.com/oktomus/ rel="noreferrer noopener" title=Instagram><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-instagram"><rect x="2" y="2" width="20" height="20" rx="5" ry="5"/><path d="M16 11.37A4 4 0 1112.63 8 4 4 0 0116 11.37z"/><line x1="17.5" y1="6.5" x2="17.5" y2="6.5"/></svg></a><a target=_blank href=https://500px.com/oktomus rel="noreferrer noopener" title=500px><svg fill="currentcolor" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" width="48" id="svg2" height="24" viewBox="0 0 666.66669 166.13333"><g transform="matrix(1.3333333,0,0,-1.3333333,0,166.13333)" id="g10"><g transform="scale(0.1)" id="g12"><path id="path14" style="fill-opacity:1;fill-rule:nonzero;stroke:none" d="m4761.93 915.121 226.03 226.029c8.2 8.21 27.42 27.46-11.48 67.51-16.68 17.18-31.89 25.95-45.19 26.05h-.24c-11.45.0-19.17-6.14-25.21-12.17L4679.28 995.977 4453.09 1223.56c-18.28 18.3-39.69 14.01-67.29-13.55-28.07-28.22-32.66-49.89-14.45-68.2l226.22-227.564-221.56-221.57-1.58-1.547c-5.39-5.227-13.53-13.113-13.64-25.973-.1-13.261 8.73-28.879 26.26-46.414 14.8-14.812 28.82-22.316 41.7-22.316h.01c14.51.012 23.78 9.308 29.02 14.543l222.4 222.41 227.42-227.449c2.87-2.86 10.88-9.457 23.74-9.457h.46c14.38.172 29.52 8.515 45.01 24.781 25.52 26.801 29.78 49.129 12.65 66.359zm-816.56 324.699c-167.5-12.74-298.71-160.06-298.71-335.394V350.023c0-32.117 24.42-38.691 61.07-38.691s61.07 6.574 61.07 38.691V905.73c0 109.24 79.47 203.04 180.91 213.54 58.24 5.94 114.22-12.29 157.76-51.56 42.74-38.52 67.26-93.909 67.28-151.972.0-16.617-8.14-70.734-45.28-120.968-28.09-37.958-81.3-83.172-175.65-83.172-.51-.012-1.2.0-1.79.0-24.21.0-44.88-1.141-48.86-58.496-2.67-38.594-2.45-55.852 30.89-60.493 59.47-8.25 120.11 3.375 180.2 34.606 102.61 53.383 171.35 154.535 179.43 264.004 7.02 95.078-27.27 187.831-94.09 254.491-67.07 66.89-159.69 101.15-254.23 94.11zM477.48 872.383C357.461 889.613 240.426 857.684 145.102 784.309V1114.5h559.531c19.437.0 33.379 3.5 33.379 60.91.0 56.02-22.571 58.24-37.465 58.24H80.9648c-35.9765.0-55.0117-29.1-55.0117-61.36V630.379c0-28.414 18.0117-38.043 51.5352-44.68 29.3477-5.808 46.3907-2.414 59.2227 11.809l1.351 2.082C197.09 684.672 325.527 767.09 447.605 752.148 593.32 734.32 710.648 618.078 726.695 475.762 736.934 384.953 709.223 297.66 648.719 229.961 588.988 163.121 503.48 124.781 414.156 124.781c-132.328.0-247.984 85.059-296.144 208.508-7.129 18.277-19.1722 31.809-71.3011 12.856C-1.1875 328.73-3.96484 308.574 2.64062 290.32 65.3398 117.672 230.711 1.66016 414.137 1.66016c124.23.0 243.121 53.26174 326.187 146.14084 84.164 94.078 122.391 215.359 108.313 341.504C826.574 686.766 673.727 844.293 477.48 872.383zM2896.61 132.852c-270.27.0-490.16 219.882-490.16 490.148.0 270.277 219.89 490.16 490.16 490.16 270.25.0 490.12-219.883 490.12-490.16.0-270.266-219.87-490.148-490.12-490.148zm0 1113.158c-343.55.0-623.04-279.483-623.04-623.01.0-343.527 279.49-623 623.04-623 343.53.0 623 279.473 623 623s-279.47 623.01-623 623.01zM1548.3 132.852c-270.27.0-490.15 219.882-490.15 490.148.0 270.277 219.88 490.16 490.15 490.16 270.26.0 490.13-219.883 490.13-490.16.0-270.266-219.87-490.148-490.13-490.148zm0 1113.158C1204.76 1246.01 925.262 966.527 925.262 623 925.262 279.473 1204.76.0 1548.3.0c343.53.0 623.01 279.473 623.01 623s-279.48 623.01-623.01 623.01"/></g></g></svg></a><a target=_blank href=https://www.flickr.com/photos/kevinmasson/ rel="noreferrer noopener" title=Flickr><svg fill="currentcolor" width="24" height="24" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 300 300" style="enable-background:new 0 0 300 300"><g id="XMLID_830_"><g id="XMLID_833_"><circle cx="67.57" cy="150" r="67.57"/></g><g id="XMLID_838_"><circle cx="232.43" cy="150" r="67.57"/></g></g></svg></a></div></header><main class=app-container><article class=post><header class=post-header><h1 class=post-title>Safely manage Blender's handlers while developing</h1><div class=post-meta>14 Jul 2017
· 4 min read<span> ·<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77a5.44 5.44.0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg>
<a href=https://github.com/oktomus/website/blob/master/content/posts/2017/safely-manage-blenders-handlers-while-developing.md rel=nofollow>1 contributor</a></span></div></header><div class=post-content><h2 id=what-is-a-handler->What is a handler ?</h2><p>Handlers are basically <strong>callbacks</strong> that you create to execute a specific function every time something happens. Blender's API currently provide <a href=https://docs.blender.org/api/blender_python_api_2_60_6/bpy.app.handlers.html>some handlers</a>, <code>frame_change_pre</code> will be used in this article. Each handler is a <strong>list of functions</strong>, in this case, every function in <code>frame_change_pre</code> will be executed before a switch of frame.</p><h2 id=the-problem>The problem</h2><p>Let's say that you are working on your callback function, everytime you change your function you will have to add it in the handler list to be able to use it. But you also have to remove the old one, otherwise, both functions would be executed. However, you can't be 100% sure which one is your function in the handler list.</p><h2 id=cant-i-just-clear-the-handler-list->Can't I just clear the handler list ?</h2><p>Take this script, run it, modify the process function and run it again.</p><div class=highlight><pre style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#6ab825;font-weight:700>from</span> <span style=color:#447fcf;text-decoration:underline>bpy.app.handlers</span> <span style=color:#6ab825;font-weight:700>import</span> frame_change_pre

<span style=color:#6ab825;font-weight:700>def</span> <span style=color:#447fcf>process</span>(scene):
    <span style=color:#6ab825;font-weight:700>print</span>(<span style=color:#ed9d13></span><span style=color:#ed9d13>&#34;</span><span style=color:#ed9d13>Hello!</span><span style=color:#ed9d13>&#34;</span>)

frame_change_pre.append(process)

</code></pre></div><p>Now, check the handler list.</p><div class=highlight><pre style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>&gt;&gt;&gt; bpy.app.handlers.frame_change_pre
[&lt;function my_func at <span style=color:#3677a9>0x7f50e1087c80</span>&gt;, &lt;function process at <span style=color:#3677a9>0x7f50e0a6d510</span>&gt;, &lt;function process at <span style=color:#3677a9>0x7f50e0a6d598</span>&gt;]
</code></pre></div><p>Every versions of your function will be executed on the handler event. So you have to remove old versions before adding a new one, but how can you be sure on which one you should delete ? The simpliest way it to clear the list before you add your function.</p><div class=highlight><pre style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>...
bpy.app.handlers.frame_change_pre.clear()
frame_change_pre.append(process)
</code></pre></div><p>But if you are using multiple handlers, or if one of your addon does, you will also get rid of them. Thus, to be sure to don't break anything, you should delete from the list only the function you add in the current script. To do that, you need to store the function you have added.</p><h2 id=use-the-driver-namespace>Use the driver namespace</h2><p><a href=https://docs.blender.org/api/blender_python_api_2_77_1/bpy.app.html#bpy.app.driver_namespace>bpy.app.driver_namespace</a> is a global dictionary. It means that you can store anything you want, and take it back the next time you execute the script.</p><p>We will store the function in this dictionnary to be able to check if the function is in the handler list before we modify it.</p><ol><li><p>Import the driver namespace</p><div class=highlight><pre style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#6ab825;font-weight:700>from</span> <span style=color:#447fcf;text-decoration:underline>bpy.app</span> <span style=color:#6ab825;font-weight:700>import</span> driver_namespace
</code></pre></div></li><li><p>Create a specific key for your callback</p><div class=highlight><pre style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>handler_key = <span style=color:#ed9d13></span><span style=color:#ed9d13>&#34;</span><span style=color:#ed9d13>DEV_FUNC_01</span><span style=color:#ed9d13>&#34;</span>
</code></pre></div><p>This key has to be unique, to be sure to don't mess with what is already in the driver namespace.</p></li><li><p>Remove the callback if it is already there</p><div class=highlight><pre style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>    <span style=color:#6ab825;font-weight:700>if</span> handler_key <span style=color:#6ab825;font-weight:700>in</span> driver_namespace:
        <span style=color:#6ab825;font-weight:700>if</span> driver_namespace[handler_key] <span style=color:#6ab825;font-weight:700>in</span> frame_change_pre:
            frame_change_pre.remove(driver_namespace[handler_key])

        <span style=color:#6ab825;font-weight:700>del</span> driver_namespace[handler_key]
</code></pre></div></li><li><p>Add the modified function in the driver namespace</p><div class=highlight><pre style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>    driver_namespace[handler_key] = process
</code></pre></div></li></ol><p>This way, you can be sure that old functions aren't in the handler list and only the newest one is present. Here is the full script.</p><div class=highlight><pre style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>
<span style=color:#6ab825;font-weight:700>from</span> <span style=color:#447fcf;text-decoration:underline>bpy.app.handlers</span> <span style=color:#6ab825;font-weight:700>import</span> frame_change_pre
<span style=color:#6ab825;font-weight:700>from</span> <span style=color:#447fcf;text-decoration:underline>bpy.app</span> <span style=color:#6ab825;font-weight:700>import</span> driver_namespace


handler_key = <span style=color:#ed9d13></span><span style=color:#ed9d13>&#34;</span><span style=color:#ed9d13>DEV_FUNC_01</span><span style=color:#ed9d13>&#34;</span>

<span style=color:#6ab825;font-weight:700>if</span> handler_key <span style=color:#6ab825;font-weight:700>in</span> driver_namespace:
<span style=color:#6ab825;font-weight:700>if</span> driver_namespace[handler_key] <span style=color:#6ab825;font-weight:700>in</span> frame_change_pre:
    frame_change_pre.remove(driver_namespace[handler_key])

<span style=color:#6ab825;font-weight:700>del</span> driver_namespace[handler_key]

<span style=color:#6ab825;font-weight:700>def</span> <span style=color:#447fcf>process</span>(scene):
<span style=color:#6ab825;font-weight:700>print</span>(<span style=color:#ed9d13></span><span style=color:#ed9d13>&#34;</span><span style=color:#ed9d13>Hello 2!</span><span style=color:#ed9d13>&#34;</span>)


frame_change_pre.append(process)
driver_namespace[handler_key] = process
</code></pre></div><div class=highlight><pre style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>You can run the script <span style=color:#6ab825;font-weight:700>and</span> check <span style=color:#6ab825;font-weight:700>in</span> the console that your function <span style=color:#6ab825;font-weight:700>is</span> here.

&gt;&gt;&gt; bpy.app.driver_namespace[<span style=color:#ed9d13></span><span style=color:#ed9d13>&#34;</span><span style=color:#ed9d13>DEV_FUNC_01</span><span style=color:#ed9d13>&#34;</span>]
&lt;function process at <span style=color:#3677a9>0x7f50e0a6d598</span>&gt;
</code></pre></div><p>And now, if you modify the process function and run the script, only the new callback will be executed.</p><h2 id=going-further-use-a-class>Going further, use a class</h2><p>If you want, you can do something more developed and for example, use a class. Like this, you will also be able to share attributes and create multiple callbacks with different parameters easily.</p><div class=highlight><pre style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#6ab825;font-weight:700>from</span> <span style=color:#447fcf;text-decoration:underline>bpy.app.handlers</span> <span style=color:#6ab825;font-weight:700>import</span> frame_change_pre
<span style=color:#6ab825;font-weight:700>from</span> <span style=color:#447fcf;text-decoration:underline>bpy.app</span> <span style=color:#6ab825;font-weight:700>import</span> driver_namespace

handler_key = <span style=color:#ed9d13></span><span style=color:#ed9d13>&#34;</span><span style=color:#ed9d13>DEV_HAND_01</span><span style=color:#ed9d13>&#34;</span>

<span style=color:#6ab825;font-weight:700>class</span> <span style=color:#447fcf;text-decoration:underline>ProcessHandler</span>():

<span style=color:#6ab825;font-weight:700>def</span> __init__(self, p_name):
    self.name = p_name

<span style=color:#6ab825;font-weight:700>def</span> <span style=color:#447fcf>process</span>(self, scene):
    <span style=color:#6ab825;font-weight:700>print</span>(self.name)

<span style=color:#6ab825;font-weight:700>def</span> <span style=color:#447fcf>remove_handler</span>(self):
    <span style=color:#6ab825;font-weight:700>if</span> self.process <span style=color:#6ab825;font-weight:700>in</span> frame_change_pre:
	frame_change_pre.remove(self.process)

<span style=color:#6ab825;font-weight:700>def</span> <span style=color:#447fcf>add_handler</span>(self):
    frame_change_pre.append(self.process)


<span style=color:#6ab825;font-weight:700>if</span> handler_key <span style=color:#6ab825;font-weight:700>in</span> driver_namespace:
driver_namespace[handler_key].remove_handler()

driver_namespace[handler_key] = ProcessHandler(<span style=color:#ed9d13></span><span style=color:#ed9d13>&#34;</span><span style=color:#ed9d13>joseph</span><span style=color:#ed9d13>&#34;</span>)
driver_namespace[handler_key].add_handler()
</code></pre></div><p>When you work on an addon, you won't do this that way, it's better to remove your callbacks in the unregister function. But while you are programming or if you don't wish to make an addon, this technique can be really usefull.</p><h2 id=why-these-snippets-doesnt-work->Why these snippets doesn't work ?</h2><h3 id=the-memory-address-has-changed>The memory address has changed</h3><div class=highlight><pre style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>    ...
    <span style=color:#6ab825;font-weight:700>if</span> process <span style=color:#6ab825;font-weight:700>in</span> frame_change_pre:
        frame_change_pre.remove(process)

    frame_change_pre.append(process)
</code></pre></div><p>Here, you already have modified the function, so its memory address won't be the same and you won't be able to find the old function in the list.</p><h3 id=remove-it-before-modifying-it>Remove it before modifying it</h3><div class=highlight><pre style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>...
<span style=color:#6ab825;font-weight:700>if</span> process <span style=color:#6ab825;font-weight:700>in</span> frame_change_pre:
frame_change_pre.remove(process)
...
<span style=color:#6ab825;font-weight:700>def</span> <span style=color:#447fcf>process</span>():
...
frame_change_pre.append(process)
</code></pre></div><p>You can't do this, because at this level, the function doesn't exists yet. This is why we store it to be able to get it when we run the script.</p><h3 id=insert-at-a-specific-index-instead-of-appending>Insert at a specific index instead of appending</h3><p>If so, imagine that you enable an addon or that you have another script which does the same, you can't be sure that your function will always be at the same index. And it's a list, its size isn't deterministic.</p></div><div class=post-footer><section id=isso-thread></section><script data-isso=https://isso.oktomus.com/ src=https://isso.oktomus.com/js/embed.min.js></script></div></article></main><script type=text/javascript>var _paq=window._paq||[];_paq.push(['trackPageView']);_paq.push(['enableLinkTracking']);(function(){var u="//matomo.oktomus.com/";_paq.push(['setTrackerUrl',u+'matomo.php']);_paq.push(['setSiteId','1']);var d=document,g=d.createElement('script'),s=d.getElementsByTagName('script')[0];g.type='text/javascript';g.async=true;g.defer=true;g.src=u+'matomo.js';s.parentNode.insertBefore(g,s);})();</script></body></html>